<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„ê³ ë³´ë“œ ë¬¼ëŸ‰ì‚°ì¶œ ì´ë¯¸ì§€ ê³µìœ </title>
    
    <!-- ì¹´ì¹´ì˜¤ SDK -->
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        /* ê³µìœ  ëª¨ë‹¬ */
        .share-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 3000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .share-modal.show {
            display: flex;
        }
        
        .share-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .share-modal h3 {
            text-align: center;
            margin: 0 0 20px 0;
            color: #333;
            font-size: 1.3rem;
        }
        
        /* ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° */
        .image-preview {
            width: 100%;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .image-preview img {
            width: 100%;
            display: block;
        }
        
        /* ì•ˆë‚´ ë©”ì‹œì§€ */
        .info-message {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #856404;
            text-align: center;
        }
        
        /* ê³µìœ  ë²„íŠ¼ë“¤ */
        .share-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .share-btn {
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .kakao-btn {
            background: #FEE500;
            color: #000000;
        }
        
        .kakao-btn:hover {
            background: #FFEB3B;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(254, 229, 0, 0.4);
        }
        
        .download-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .cancel-btn {
            background: #e0e0e0;
            color: #666;
        }
        
        .cancel-btn:hover {
            background: #d0d0d0;
        }
        
        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #4CAF50;
            color: white;
            padding: 16px 24px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 4000;
            display: none;
            animation: fadeInOut 3s ease;
            max-width: 90%;
            text-align: center;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            10%, 90% { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        
        .toast.show {
            display: block;
        }
        
        /* í…ŒìŠ¤íŠ¸ ë²„íŠ¼ */
        .test-btn {
            padding: 15px 30px;
            font-size: 18px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 20px 0;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        /* CanvasëŠ” ìˆ¨ê¹€ */
        #resultCanvas {
            display: none;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
    </style>
</head>
<body>

<h1>ğŸ“Š ì„ê³ ë³´ë“œ ë¬¼ëŸ‰ ì‚°ì¶œ</h1>
<p style="color: #666;">ì‚°ì¶œ ê²°ê³¼ë¥¼ ì´ë¯¸ì§€ë¡œ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
<button onclick="shareResult()" class="test-btn">ğŸ”— ê³µìœ í•˜ê¸°</button>

<!-- Canvas ìš”ì†Œ (ìˆ¨ê¹€) -->
<canvas id="resultCanvas"></canvas>

<script>
// ============================================
// ì¹´ì¹´ì˜¤ SDK ì´ˆê¸°í™”
// ============================================
Kakao.init('fbae899fb0be422001174b09533e1918');
console.log('ì¹´ì¹´ì˜¤ SDK ì´ˆê¸°í™”:', Kakao.isInitialized());

// ============================================
// í…ŒìŠ¤íŠ¸ìš© ë³€ìˆ˜ (ì‹¤ì œ ì½”ë“œì—ì„œëŠ” ì‹¤ì œ ë³€ìˆ˜ ì‚¬ìš©)
// ============================================
let currentSiteName = 'í…ŒìŠ¤íŠ¸ í˜„ì¥';
let currentLossRate = 0.1;

// ì˜ˆì‹œ ë°ì´í„° (ì‹¤ì œë¡œëŠ” walls ë°°ì—´ ì‚¬ìš©)
const sampleData = {
    boards: [
        { type: 'ì¼ë°˜', size: '1200Ã—2400', thickness: '9.5T', quantity: 100 },
        { type: 'ë°©í™”', size: '1200Ã—2400', thickness: '12.5T', quantity: 50 },
        { type: 'ë°©ìˆ˜', size: '1200Ã—2400', thickness: '12.5T', quantity: 30 }
    ],
    joists: [
        { name: '38Ã—89 SPF', length: '2700mm', quantity: 150 },
        { name: '50Ã—50 ê°ì¬', length: '2700mm', quantity: 80 },
        { name: '40Ã—60 ê°ì¬', length: '2700mm', quantity: 45 }
    ]
};

// ============================================
// Canvasë¡œ ì´ë¯¸ì§€ ìƒì„±
// ============================================
function generateImage(data) {
    const canvas = document.getElementById('resultCanvas');
    const ctx = canvas.getContext('2d');
    
    // Canvas í¬ê¸° ì„¤ì •
    const width = 800;
    canvas.width = width;
    
    let y = 40;
    
    // ì„ì‹œ ë†’ì´ ì„¤ì •
    canvas.height = 800;
    
    // ë°°ê²½ìƒ‰
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, width, canvas.height);
    
    // í—¤ë” ë°°ê²½
    const gradient = ctx.createLinearGradient(0, 0, width, 0);
    gradient.addColorStop(0, '#667eea');
    gradient.addColorStop(1, '#764ba2');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, width, 120);
    
    // ì œëª©
    ctx.fillStyle = '#ffffff';
    ctx.font = 'bold 32px Malgun Gothic, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('ğŸ“Š ì„ê³ ë³´ë“œ ë¬¼ëŸ‰ ì‚°ì¶œ', width / 2, y + 25);
    
    // í˜„ì¥ëª…
    ctx.font = 'bold 24px Malgun Gothic, sans-serif';
    ctx.fillText(currentSiteName || 'ì„ê³ ë³´ë“œ ì‚°ì¶œ', width / 2, y + 60);
    
    y = 140;
    
    // ì •ë³´ ë°•ìŠ¤
    ctx.fillStyle = '#f8f9fa';
    ctx.fillRect(30, y, width - 60, 50);
    ctx.strokeStyle = '#e0e0e0';
    ctx.lineWidth = 2;
    ctx.strokeRect(30, y, width - 60, 50);
    
    ctx.fillStyle = '#333333';
    ctx.font = '16px Malgun Gothic, sans-serif';
    ctx.textAlign = 'left';
    const dateStr = new Date().toLocaleString('ko-KR', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
    });
    ctx.fillText(`ì‘ì„±ì¼: ${dateStr}`, 50, y + 30);
    ctx.fillText(`ë¡œìŠ¤ìœ¨: ${Math.round(currentLossRate * 100)}%`, 550, y + 30);
    
    y += 80;
    
    // ì„ê³ ë³´ë“œ ì„¹ì…˜
    ctx.fillStyle = '#667eea';
    ctx.font = 'bold 22px Malgun Gothic, sans-serif';
    ctx.fillText('â–  ì„ê³ ë³´ë“œ', 50, y);
    y += 35;
    
    // í…Œì´ë¸” í—¤ë”
    ctx.fillStyle = '#f0f0f0';
    ctx.fillRect(30, y, width - 60, 40);
    ctx.strokeStyle = '#cccccc';
    ctx.strokeRect(30, y, width - 60, 40);
    
    ctx.fillStyle = '#333333';
    ctx.font = 'bold 16px Malgun Gothic, sans-serif';
    ctx.fillText('ì¢…ë¥˜', 50, y + 25);
    ctx.fillText('ê·œê²©', 250, y + 25);
    ctx.fillText('ë‘ê»˜', 450, y + 25);
    ctx.fillText('ìˆ˜ëŸ‰', 620, y + 25);
    
    y += 40;
    
    // ì„ê³ ë³´ë“œ ë°ì´í„°
    ctx.font = '16px Malgun Gothic, sans-serif';
    data.boards.forEach((board, index) => {
        ctx.fillStyle = index % 2 === 0 ? '#ffffff' : '#f9f9f9';
        ctx.fillRect(30, y, width - 60, 40);
        ctx.strokeStyle = '#e0e0e0';
        ctx.strokeRect(30, y, width - 60, 40);
        
        ctx.fillStyle = '#333333';
        ctx.fillText(board.type, 50, y + 25);
        ctx.fillText(board.size, 250, y + 25);
        ctx.fillText(board.thickness, 450, y + 25);
        ctx.fillText(`${board.quantity}ì¥`, 620, y + 25);
        
        y += 40;
    });
    
    y += 20;
    
    // ëª©ìì¬ ì„¹ì…˜
    ctx.fillStyle = '#764ba2';
    ctx.font = 'bold 22px Malgun Gothic, sans-serif';
    ctx.fillText('â–  ëª©ìì¬/ê°ì¬', 50, y);
    y += 35;
    
    // í…Œì´ë¸” í—¤ë”
    ctx.fillStyle = '#f0f0f0';
    ctx.fillRect(30, y, width - 60, 40);
    ctx.strokeStyle = '#cccccc';
    ctx.strokeRect(30, y, width - 60, 40);
    
    ctx.fillStyle = '#333333';
    ctx.font = 'bold 16px Malgun Gothic, sans-serif';
    ctx.fillText('í’ˆëª…', 50, y + 25);
    ctx.fillText('ê¸¸ì´', 400, y + 25);
    ctx.fillText('ìˆ˜ëŸ‰', 620, y + 25);
    
    y += 40;
    
    // ê°ì¬ ë°ì´í„°
    ctx.font = '16px Malgun Gothic, sans-serif';
    data.joists.forEach((joist, index) => {
        ctx.fillStyle = index % 2 === 0 ? '#ffffff' : '#f9f9f9';
        ctx.fillRect(30, y, width - 60, 40);
        ctx.strokeStyle = '#e0e0e0';
        ctx.strokeRect(30, y, width - 60, 40);
        
        ctx.fillStyle = '#333333';
        ctx.fillText(joist.name, 50, y + 25);
        ctx.fillText(joist.length, 400, y + 25);
        ctx.fillText(`${joist.quantity}ê°œ`, 620, y + 25);
        
        y += 40;
    });
    
    // ìµœì¢… ë†’ì´ ì¡°ì •
    canvas.height = y + 40;
    
    return new Promise((resolve) => {
        canvas.toBlob((blob) => {
            resolve(blob);
        }, 'image/png');
    });
}

// ============================================
// í…ìŠ¤íŠ¸ ë²„ì „ ìƒì„±
// ============================================
function generateSummaryText() {
    let text = `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    text += `ğŸ“Š ${currentSiteName}\n`;
    text += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    text += `ì‘ì„±ì¼: ${new Date().toLocaleString('ko-KR')}\n`;
    text += `ë¡œìŠ¤ìœ¨: ${Math.round(currentLossRate * 100)}%\n\n`;
    
    text += `ã€ì„ê³ ë³´ë“œã€‘\n`;
    sampleData.boards.forEach(board => {
        text += `â–ª ${board.type} ${board.size} ${board.thickness}\n`;
        text += `  â†’ ${board.quantity}ì¥\n`;
    });
    
    text += `\nã€ëª©ìì¬/ê°ì¬ã€‘\n`;
    sampleData.joists.forEach(joist => {
        text += `â–ª ${joist.name} (${joist.length})\n`;
        text += `  â†’ ${joist.quantity}ê°œ\n`;
    });
    
    text += `\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`;
    
    return text;
}

// ============================================
// ê³µìœ  ëª¨ë‹¬ ì—´ê¸°
// ============================================
async function shareResult() {
    // ë¡œë”© í‘œì‹œ
    const loadingModal = document.createElement('div');
    loadingModal.className = 'share-modal show';
    loadingModal.id = 'loadingModal';
    loadingModal.innerHTML = `
        <div class="share-modal-content">
            <div class="loading">
                <p style="font-size: 18px; margin: 0;">ğŸ¨ ì´ë¯¸ì§€ ìƒì„± ì¤‘...</p>
            </div>
        </div>
    `;
    document.body.appendChild(loadingModal);
    
    // ì´ë¯¸ì§€ ìƒì„±
    const imageBlob = await generateImage(sampleData);
    const imageUrl = URL.createObjectURL(imageBlob);
    
    // ë¡œë”© ì œê±°
    loadingModal.remove();
    
    // ëª¨ë°”ì¼ ì—¬ë¶€ í™•ì¸
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    // ê³µìœ  ëª¨ë‹¬
    const modal = document.createElement('div');
    modal.className = 'share-modal show';
    modal.id = 'shareModal';
    
    let infoHTML = '';
    if (isMobile) {
        infoHTML = `<div class="info-message">ğŸ’¡ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•œ í›„ ì¹´ì¹´ì˜¤í†¡ì—ì„œ íŒŒì¼ë¡œ ì „ì†¡í•˜ì„¸ìš”</div>`;
    } else {
        infoHTML = `<div class="info-message">ğŸ’¡ PCì—ì„œëŠ” í…ìŠ¤íŠ¸ë¥¼ ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì „ì†¡í•˜ê³ ,<br>ì´ë¯¸ì§€ëŠ” ì €ì¥ í›„ íŒŒì¼ë¡œ ì „ì†¡í•˜ì„¸ìš”</div>`;
    }
    
    modal.innerHTML = `
        <div class="share-modal-content">
            <h3>ğŸ“¤ ê³µìœ  ë°©ë²• ì„ íƒ</h3>
            <div class="image-preview">
                <img src="${imageUrl}" alt="ì‚°ì¶œ ê²°ê³¼">
            </div>
            ${infoHTML}
            <div class="share-buttons">
                <button class="share-btn kakao-btn" onclick="shareToKakaoText()">
                    ğŸ’¬ ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ í…ìŠ¤íŠ¸ ì „ì†¡
                </button>
                <button class="share-btn download-btn" onclick="downloadImage()">
                    ğŸ’¾ ì´ë¯¸ì§€ ì €ì¥í•˜ê¸°
                </button>
                <button class="share-btn cancel-btn" onclick="closeShareModal()">
                    ì·¨ì†Œ
                </button>
            </div>
        </div>
    `;
    
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            closeShareModal();
        }
    });
    
    document.body.appendChild(modal);
    
    window.currentImageBlob = imageBlob;
    window.currentImageUrl = imageUrl;
}

function closeShareModal() {
    const modal = document.getElementById('shareModal');
    if (modal) {
        modal.remove();
    }
    if (window.currentImageUrl) {
        URL.revokeObjectURL(window.currentImageUrl);
    }
}

// ============================================
// ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ í…ìŠ¤íŠ¸ ì „ì†¡
// ============================================
function shareToKakaoText() {
    const summaryText = generateSummaryText();
    
    try {
        Kakao.Share.sendDefault({
            objectType: 'text',
            text: summaryText,
            link: {
                mobileWebUrl: window.location.href,
                webUrl: window.location.href,
            },
            buttons: [
                {
                    title: 'ì›¹ì—ì„œ ë³´ê¸°',
                    link: {
                        mobileWebUrl: window.location.href,
                        webUrl: window.location.href,
                    },
                },
            ],
        });
        
        showToast('âœ… ì¹´ì¹´ì˜¤í†¡ ì°½ì´ ì—´ë¦½ë‹ˆë‹¤!');
        
    } catch (error) {
        console.error('ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ì‹¤íŒ¨:', error);
        showToast('âŒ ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ì‹¤íŒ¨. ì´ë¯¸ì§€ë¥¼ ì €ì¥í•´ì£¼ì„¸ìš”.');
    }
}

// ============================================
// ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
// ============================================
function downloadImage() {
    const imageUrl = window.currentImageUrl;
    
    if (!imageUrl) {
        showToast('ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨');
        return;
    }
    
    const link = document.createElement('a');
    const fileName = `ì„ê³ ë³´ë“œ_ë¬¼ëŸ‰ì‚°ì¶œ_${currentSiteName}_${new Date().getTime()}.png`;
    link.href = imageUrl;
    link.download = fileName;
    link.click();
    
    showToast('ğŸ’¾ ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
}

// ============================================
// í† ìŠ¤íŠ¸ ë©”ì‹œì§€
// ============================================
function showToast(message) {
    let toast = document.getElementById('toast');
    if (!toast) {
        toast = document.createElement('div');
        toast.className = 'toast';
        toast.id = 'toast';
        document.body.appendChild(toast);
    }
    
    toast.textContent = message;
    toast.classList.add('show');
    
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

</script>

</body>
</html>
